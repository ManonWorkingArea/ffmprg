<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .task-card { transition: all 0.2s ease; }
        .task-card:hover { transform: translateY(-1px); }
    </style>
</head>
<body class="bg-white">
    <div id="app">
        <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
        <div v-if="showNotification"
             class="fixed top-4 right-4 bg-gray-900 text-white px-4 py-2 rounded-md text-sm">
            {{ notificationMessage }}
        </div>

        <div class="min-h-screen py-6 px-4">
            <div class="max-w-5xl mx-auto">
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß -->
                <div class="mb-8">
                    <h1 class="text-2xl font-medium text-gray-900">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</h1>
                    <p class="text-sm text-gray-500 mt-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    <div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md">
                        <p class="text-xs text-blue-700">
                            <i class="fas fa-info-circle mr-1"></i>
                            <strong>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ:</strong> ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ 
                            ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡∏π‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à
                        </p>
                    </div>
                </div>
                
                <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="border rounded-lg p-4">
                        <p class="text-sm text-gray-500">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        <p class="text-2xl font-medium mt-1">{{ stats.total }}</p>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <p class="text-sm text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</p>
                        <p class="text-2xl font-medium mt-1 text-blue-600">{{ stats.processing }}</p>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <p class="text-sm text-gray-500">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                        <p class="text-2xl font-medium mt-1 text-green-600">{{ stats.completed }}</p>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <p class="text-sm text-gray-500">‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
                        <p class="text-2xl font-medium mt-1 text-red-600">{{ stats.error }}</p>
                    </div>
                </div>

                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° data ‡πÉ‡∏ô Vue app -->
                <div class="mb-8">
                    <h2 class="text-lg font-medium mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- CPU Usage -->
                        <div class="border rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-500">CPU</span>
                                <span class="text-sm font-medium">{{ systemMetrics.cpu.cores }} Cores</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-1.5 mb-1">
                                <div class="bg-blue-500 h-1.5 rounded-full transition-all" 
                                     :style="{ width: systemMetrics.cpu.usage + '%' }"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>Usage</span>
                                <span>{{ Math.round(systemMetrics.cpu.usage) }}%</span>
                            </div>
                        </div>

                        <!-- Memory Usage -->
                        <div class="border rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-500">Memory</span>
                                <span class="text-sm font-medium">{{ Math.round(systemMetrics.memory.total) }} MB</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-1.5 mb-1">
                                <div class="bg-green-500 h-1.5 rounded-full transition-all" 
                                     :style="{ width: systemMetrics.memory.usagePercent + '%' }"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>Used: {{ Math.round(systemMetrics.memory.used) }} MB</span>
                                <span>{{ Math.round(systemMetrics.memory.usagePercent) }}%</span>
                            </div>
                        </div>

                        <!-- Disk Usage -->
                        <div class="border rounded-lg p-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-gray-500">Disk</span>
                                <span class="text-sm font-medium">{{ Math.round(systemMetrics.disk.total) }} GB</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-1.5 mb-1">
                                <div class="bg-yellow-500 h-1.5 rounded-full transition-all" 
                                     :style="{ width: systemMetrics.disk.usagePercent + '%' }"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>Used: {{ Math.round(systemMetrics.disk.used) }} GB</span>
                                <span>{{ Math.round(systemMetrics.disk.usagePercent) }}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô -->
                <div class="border rounded-lg">
                    <div class="p-4">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-lg font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                            <div class="flex items-center gap-4">
                                <button @click="startQueue" 
                                        class="text-xs px-3 py-1.5 bg-blue-500 text-white rounded hover:bg-blue-600">
                                    <i class="fas fa-play mr-1"></i>‡πÄ‡∏£‡∏¥‡πà‡∏° Queue
                                </button>
                                <button @click="debugQueue" 
                                        class="text-xs px-3 py-1.5 bg-gray-500 text-white rounded hover:bg-gray-600">
                                    <i class="fas fa-bug mr-1"></i>Debug
                                </button>
                                <button @click="resetQueue" 
                                        class="text-xs px-3 py-1.5 bg-red-500 text-white rounded hover:bg-red-600">
                                    <i class="fas fa-refresh mr-1"></i>Reset
                                </button>
                                <div class="text-xs text-gray-500">
                                    <i class="fas fa-sync-alt mr-1"></i>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                                </div>
                            </div>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á Loading -->
                        <div v-if="loading" class="space-y-3">
                            <div v-for="n in 3" :key="n" class="animate-pulse">
                                <div class="h-16 bg-gray-50 rounded-md"></div>
                            </div>
                        </div>
                        
                        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô -->
                        <div v-else class="space-y-3">
                            <div v-for="task in tasks" :key="task.taskId" 
                                 class="task-card border rounded-md p-4"
                                 :class="getStatusColor(task.status)">
                                
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="flex items-center gap-2 mb-2">
                                            <i :class="getStatusIcon(task.status)" 
                                               class="text-base"
                                               :class="getStatusIconColor(task.status)"></i>
                                            <span class="text-sm font-medium">{{ task.taskId }}</span>
                                        </div>
                                        
                                        <div class="space-y-1 text-xs text-gray-500">
                                            <p>‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û: {{ task.quality }}</p>
                                            <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: {{ formatDate(task.createdAt) }}</p>
                                            <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: {{ getStatusText(task.status) }}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-4">
                                        <div v-if="task.status === 'processing'" class="text-right">
                                            <div class="w-32 bg-gray-100 rounded-full h-1.5">
                                                <div class="bg-blue-500 h-1.5 rounded-full transition-all" 
                                                     :style="{ width: task.percent + '%' }"></div>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-1">{{ task.percent }}%</p>
                                        </div>
                                        
                                        <div class="flex gap-2">
                                            <button v-if="task.status === 'processing'"
                                                    @click="stopTask(task.taskId)"
                                                    class="text-xs px-3 py-1.5 border border-red-200 text-red-600 rounded hover:bg-red-50">
                                                ‡∏´‡∏¢‡∏∏‡∏î
                                            </button>
                                            
                                            <button v-if="task.status === 'downloading' || task.status === 'error'"
                                                    @click="restartTask(task.taskId)"
                                                    class="text-xs px-3 py-1.5 border border-blue-200 text-blue-600 rounded hover:bg-blue-50">
                                                <i class="fas fa-redo mr-1"></i>‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó
                                            </button>
                                            
                                            <a v-if="task.status === 'completed'" 
                                               :href="'/outputs/' + task.taskId + '-output.mp4'"
                                               class="text-xs px-3 py-1.5 border border-green-200 text-green-600 rounded hover:bg-green-50">
                                                ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
                                            </a>
                                            
                                            <button @click="deleteTask(task.taskId)"
                                                    class="text-xs px-3 py-1.5 border border-gray-200 text-gray-600 rounded hover:bg-gray-50"
                                                    title="‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="mt-8 border-t pt-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Server Details -->
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</h3>
                            <div class="space-y-2 text-xs text-gray-600">
                                <p><span class="font-medium">Web Framework:</span> {{ serverInfo.server.framework }}</p>
                                <p><span class="font-medium">Server Port:</span> {{ serverInfo.server.port }}</p>
                                <p><span class="font-medium">Base URL:</span> {{ serverInfo.server.baseUrl }}</p>
                                <p><span class="font-medium">Storage:</span> {{ serverInfo.server.storage.database }} + {{ serverInfo.server.storage.fileStorage }}</p>
                                <p><span class="font-medium">Middleware:</span> {{ serverInfo.server.middleware.join(', ') }}</p>
                            </div>
                        </div>

                        <!-- FFmpeg Details -->
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 mb-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î FFmpeg</h3>
                            <div class="space-y-2 text-xs text-gray-600">
                                <p><span class="font-medium">Library:</span> {{ serverInfo.ffmpeg.library }}</p>
                                <p><span class="font-medium">Version:</span> {{ serverInfo.ffmpeg.version }}</p>
                                <p><span class="font-medium">Video Codec:</span> {{ serverInfo.ffmpeg.videoCodec }}</p>
                                <p><span class="font-medium">Preset:</span> {{ serverInfo.ffmpeg.preset }}</p>
                                <p><span class="font-medium">CRF Value:</span> {{ serverInfo.ffmpeg.crfValue }}</p>
                                <p><span class="font-medium">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</span> {{ serverInfo.ffmpeg.supportedResolutions.join(', ') }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-center text-xs text-gray-500">
                        <p>¬© {{ new Date().getFullYear() }} Video Transcoding Service. All rights reserved.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        const app = createApp({
            data() {
                return {
                    tasks: [],
                    refreshInterval: null,
                    stats: {
                        total: 0,
                        processing: 0,
                        completed: 0,
                        error: 0
                    },
                    loading: true,
                    showNotification: false,
                    notificationMessage: '',
                    systemMetrics: {
                        cpu: { usage: 0, cores: 0 },
                        memory: { total: 0, used: 0, free: 0, usagePercent: 0 },
                        disk: { total: 0, used: 0, free: 0, usagePercent: 0 }
                    },
                    metricsInterval: null,
                    serverInfo: {
                        server: {
                            framework: '',
                            port: '',
                            baseUrl: '',
                            storage: { database: '', fileStorage: '' },
                            middleware: []
                        },
                        ffmpeg: {
                            library: '',
                            version: '',
                            videoCodec: '',
                            preset: '',
                            crfValue: '',
                            supportedResolutions: []
                        }
                    },
                    completedTasks: new Set() // ‡πÄ‡∏Å‡πá‡∏ö task ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ã‡πâ‡∏≥
                }
            },

            mounted() {
                this.fetchTasks()
                this.refreshInterval = setInterval(this.fetchTasks, 5000)
                this.fetchSystemMetrics()
                this.metricsInterval = setInterval(this.fetchSystemMetrics, 2000)
                this.fetchServerInfo()
                
                // ‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                this.requestNotificationPermission()
            },

            beforeUnmount() {
                clearInterval(this.refreshInterval)
                clearInterval(this.metricsInterval)
            },

            methods: {
                async fetchTasks() {
                    try {
                        const response = await fetch('/tasks')
                        const data = await response.json()
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö task ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
                        if (this.tasks.length > 0) {
                            data.tasks.forEach(task => {
                                const oldTask = this.tasks.find(t => t.taskId === task.taskId)
                                if (oldTask && oldTask.status !== 'completed' && task.status === 'completed') {
                                    this.showCompletionNotification(task)
                                }
                            })
                        }
                        
                        this.tasks = data.tasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        this.updateStats()
                        this.loading = false
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error)
                        this.showNotification = true
                        this.notificationMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
                        setTimeout(() => this.showNotification = false, 3000)
                    }
                },

                showCompletionNotification(task) {
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', {
                            body: `Task ${task.taskId.substring(0, 8)} (${task.quality}) ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß`,
                            icon: '/favicon.ico',
                            tag: task.taskId
                        })
                    }
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô UI
                    this.showNotification = true
                    this.notificationMessage = `üéâ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! (${task.quality})`
                    setTimeout(() => this.showNotification = false, 5000)
                },

                requestNotificationPermission() {
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                console.log('Notification permission granted')
                            }
                        })
                    }
                },

                updateStats() {
                    this.stats = {
                        total: this.tasks.length,
                        processing: this.tasks.filter(t => t.status === 'processing').length,
                        completed: this.tasks.filter(t => t.status === 'completed').length,
                        error: this.tasks.filter(t => t.status === 'error').length
                    }
                },

                async stopTask(taskId) {
                    try {
                        await fetch(`/stop/${taskId}`, { method: 'POST' })
                        this.showNotification = true
                        this.notificationMessage = '‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'
                        setTimeout(() => this.showNotification = false, 3000)
                        this.fetchTasks()
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô:', error)
                    }
                },

                async deleteTask(taskId) {
                    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                        return
                    }
                    
                    try {
                        const response = await fetch(`/task/${taskId}`, { method: 'DELETE' })
                        const data = await response.json()
                        
                        if (data.success) {
                            this.showNotification = true
                            this.notificationMessage = '‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'
                            setTimeout(() => this.showNotification = false, 3000)
                            this.fetchTasks()
                        } else {
                            throw new Error(data.error)
                        }
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô:', error)
                        this.showNotification = true
                        this.notificationMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô'
                        setTimeout(() => this.showNotification = false, 3000)
                    }
                },

                async startQueue() {
                    try {
                        const response = await fetch('/start-queue', { method: 'POST' })
                        const data = await response.json()
                        
                        if (data.success) {
                            this.showNotification = true
                            this.notificationMessage = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• Queue ‡πÅ‡∏•‡πâ‡∏ß'
                            setTimeout(() => this.showNotification = false, 3000)
                            this.fetchTasks()
                        } else {
                            throw new Error(data.error)
                        }
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏° Queue:', error)
                        this.showNotification = true
                        this.notificationMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏° Queue'
                        setTimeout(() => this.showNotification = false, 3000)
                    }
                },

                async debugQueue() {
                    try {
                        const response = await fetch('/debug/queue')
                        const data = await response.json()
                        
                        if (data.success) {
                            console.log('Debug Info:', data.debug)
                            alert(`Debug Info:
isProcessing: ${data.debug.isProcessing}
Queued Tasks: ${data.debug.queuedCount}
Processing Tasks: ${data.debug.processingCount}
Total Tasks: ${data.debug.totalTasks}
FFmpeg Processes: ${data.debug.ffmpegProcesses.length}

Check console for full details.`)
                        }
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á Debug Info:', error)
                    }
                },

                async resetQueue() {
                    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Queue? ‡∏ô‡∏µ‡πà‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô')) {
                        return
                    }
                    
                    try {
                        const response = await fetch('/debug/reset', { method: 'POST' })
                        const data = await response.json()
                        
                        if (data.success) {
                            this.showNotification = true
                            this.notificationMessage = '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Queue ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'
                            setTimeout(() => this.showNotification = false, 3000)
                            // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏° queue ‡πÉ‡∏´‡∏°‡πà
                            setTimeout(() => {
                                this.startQueue()
                            }, 1000)
                        }
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï:', error)
                    }
                },

                async restartTask(taskId) {
                    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?')) {
                        return
                    }
                    
                    try {
                        const response = await fetch(`/restart/${taskId}`, { method: 'POST' })
                        const data = await response.json()
                        
                        if (data.success) {
                            this.showNotification = true
                            this.notificationMessage = '‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'
                            setTimeout(() => this.showNotification = false, 3000)
                            this.fetchTasks()
                        } else {
                            throw new Error(data.error)
                        }
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏á‡∏≤‡∏ô:', error)
                        this.showNotification = true
                        this.notificationMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏á‡∏≤‡∏ô'
                        setTimeout(() => this.showNotification = false, 3000)
                    }
                },

                getStatusColor(status) {
                    const colors = {
                        'queued': 'bg-gray-50',
                        'downloading': 'bg-yellow-50',
                        'processing': 'bg-blue-50',
                        'completed': 'bg-green-50',
                        'error': 'bg-red-50',
                        'stopped': 'bg-gray-50'
                    }
                    return colors[status] || 'bg-gray-50'
                },

                getStatusIcon(status) {
                    const icons = {
                        'queued': 'fas fa-clock',
                        'downloading': 'fas fa-download',
                        'processing': 'fas fa-spinner fa-spin',
                        'completed': 'fas fa-check-circle',
                        'error': 'fas fa-exclamation-circle',
                        'stopped': 'fas fa-stop-circle'
                    }
                    return icons[status] || 'fas fa-question-circle'
                },

                getStatusText(status) {
                    const texts = {
                        'queued': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                        'downloading': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î',
                        'processing': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•',
                        'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                        'error': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        'stopped': '‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'
                    }
                    return texts[status] || status
                },

                formatDate(date) {
                    return new Date(date).toLocaleString('th-TH', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                },

                getStatusIconColor(status) {
                    const colors = {
                        'queued': 'text-gray-400',
                        'downloading': 'text-yellow-500',
                        'processing': 'text-blue-500',
                        'completed': 'text-green-500',
                        'error': 'text-red-500',
                        'stopped': 'text-gray-400'
                    }
                    return colors[status] || 'text-gray-400'
                },

                async fetchSystemMetrics() {
                    try {
                        const response = await fetch('/system-metrics')
                        const data = await response.json()
                        this.systemMetrics = data
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö:', error)
                    }
                },

                async fetchServerInfo() {
                    try {
                        const response = await fetch('/server-info')
                        const data = await response.json()
                        this.serverInfo = data
                    } catch (error) {
                        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:', error)
                    }
                }
            }
        })

        app.mount('#app')
    </script>
</body>
</html> 